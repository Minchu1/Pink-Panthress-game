<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Profile</title>
  <link href="https://fonts.googleapis.com/css2?family=Nerko+One&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Nerko One', cursive; background:#1a1a1a; color:white; text-align:center; padding:20px; }
    button { padding:10px 20px; border:none; border-radius:12px; background:#e63946; color:white; font-size:18px; cursor:pointer; }
    button:hover { background:#ff4d5b; }
    .card { background:#222; padding:20px; border-radius:20px; display:inline-block; margin-top:20px; }
  </style>
</head>
<body>
  <h1>My Profile</h1>
  <div class="card">
    <p id="timeDisplay">Loading your completion time...</p>
    <button id="deleteBtn">Delete My Completion Time</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getDatabase, ref, child, get, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // ðŸ”¹ Replace with your config
    const firebaseConfig = {
        apiKey: "AIzaSyAjJH-gJjPcZeS1Ph-JL15_aN3cq5Ecr5Q",
        authDomain: "pinkpanther-27795.firebaseapp.com",
        databaseURL: "https://pinkpanther-27795-default-rtdb.firebaseio.com",
        projectId: "pinkpanther-27795",
        storageBucket: "pinkpanther-27795.appspot.com",
        messagingSenderId: "950188314786",
        appId: "1:950188314786:web:1be4f4c1e9ed874567c7fb"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const timeDisplay = document.getElementById("timeDisplay");
    const deleteBtn = document.getElementById("deleteBtn");

  onAuthStateChanged(auth, async (user) => {
  if (user) {
    const uid = user.uid;
    const userTimeRef = ref(db, `completionTimes/${uid}`);

    const snap = await get(userTimeRef);
    if (snap.exists()) {
      const val = snap.val();
      let bestTime;

      // Case 1: flat
      if (val.time !== undefined) {
        bestTime = val.time;
      }
      // Case 2: nested â†’ find the fastest run
      else {
        const runs = Object.values(val);
        bestTime = Math.min(...runs.map(r => r.time));
      }

      timeDisplay.textContent = `Your best time: ${bestTime.toFixed(2)} seconds`;
    } else {
      timeDisplay.textContent = "No completion time saved.";
      deleteBtn.style.display = "none";
    }

    // Delete button
    deleteBtn.onclick = async () => {
      if (confirm("Are you sure you want to delete your completion time?")) {
        await remove(userTimeRef);
        timeDisplay.textContent = "Your completion time has been deleted.";
        deleteBtn.style.display = "none";
      }
    };
  } else {
    timeDisplay.textContent = "Please sign in to see your data.";
    deleteBtn.style.display = "none";
  }
});

  </script>
</body>
</html>
